angular.module("ui.sortable",[]).value("uiSortableConfig",{items:"> [ng-repeat],> [data-ng-repeat],> [x-ng-repeat]"}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(e,t,n){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"="},link:function(o,r,l,i){function a(e,t){var n=e&&"function"==typeof e,o=t&&"function"==typeof t;return n&&o?function(){e.apply(this,arguments),t.apply(this,arguments)}:o?t:e}function u(e){var t=e.data("ui-sortable");return t&&"object"==typeof t&&"ui-sortable"===t.widgetFullName?t:null}function s(t,n){return M[t]?("stop"===t&&(n=a(n,function(){o.$apply()}),n=a(n,g)),n=a(M[t],n)):V[t]&&(n=V[t](n)),n||("items"===t?n=e.items:"ui-model-items"===t&&(n=e.items)),n}function c(e,t,n){function o(e,t){t in x||(x[t]=null)}angular.forEach(M,o);var r=null;if(t){var l;angular.forEach(t,function(t,n){if(!(e&&n in e)){if(n in S)return void("ui-floating"===n?x[n]="auto":x[n]=s(n,void 0));l||(l=angular.element.ui.sortable().options);var o=l[n];o=s(n,o),r||(r={}),r[n]=o,x[n]=o}})}return angular.forEach(e,function(e,t){return t in S?("ui-floating"!==t||e!==!1&&e!==!0||!n||(n.floating=e),void(x[t]=s(t,e))):(e=s(t,e),r||(r={}),r[t]=e,void(x[t]=e))}),r}function d(e){var t=e.sortable("option","placeholder");if(t&&t.element&&"function"==typeof t.element){var n=t.element();return n=angular.element(n)}return null}function m(e,t){var n=x["ui-model-items"].replace(/[^,]*>/g,""),o=e.find('[class="'+t.attr("class")+'"]:not('+n+")");return o}function f(e,t){var n=e.sortable("option","helper");return"clone"===n||"function"==typeof n&&t.item.sortable.isCustomHelperUsed()}function b(e,t,n){var o=null;return f(e,t)&&"parent"===e.sortable("option","appendTo")&&(o=n.last()),o}function p(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}function v(e,t){for(var n=null,o=0;o<e.length;o++){var r=e[o];if(r.element[0]===t[0]){n=r.scope;break}}return n}function g(e,t){t.item.sortable._destroy()}function h(e){return e.parent().find(x["ui-model-items"]).index(e)}function y(){o.$watchCollection("ngModel",function(){t(function(){u(r)&&r.sortable("refresh")},0,!1)}),M.start=function(e,t){if("auto"===x["ui-floating"]){var n=t.item.siblings(),o=u(angular.element(e.target));o.floating=p(n)}var r=h(t.item);t.item.sortable={model:i.$modelValue[r],index:r,source:t.item.parent(),sourceModel:i.$modelValue,cancel:function(){t.item.sortable._isCanceled=!0},isCanceled:function(){return t.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!t.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:t.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(t.item.sortable,function(e,n){t.item.sortable[n]=void 0})}}},M.activate=function(e,t){_=r.contents();var n=d(r);if(n&&n.length){var l=m(r,n);_=_.not(l)}var i=t.item.sortable._connectedSortables||[];i.push({element:r,scope:o}),t.item.sortable._connectedSortables=i},M.update=function(e,t){if(!t.item.sortable.received){t.item.sortable.dropindex=h(t.item);var n=t.item.parent();t.item.sortable.droptarget=n;var l=v(t.item.sortable._connectedSortables,n);t.item.sortable.droptargetModel=l.ngModel,r.sortable("cancel")}var a=!t.item.sortable.received&&b(r,t,_);a&&a.length&&(_=_.not(a)),_.appendTo(r),t.item.sortable.received&&(_=null),t.item.sortable.received&&!t.item.sortable.isCanceled()&&o.$apply(function(){i.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})},M.stop=function(e,t){if(!t.item.sortable.received&&"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled())o.$apply(function(){i.$modelValue.splice(t.item.sortable.dropindex,0,i.$modelValue.splice(t.item.sortable.index,1)[0])});else if((!("dropindex"in t.item.sortable)||t.item.sortable.isCanceled())&&!angular.equals(r.contents(),_)){var n=b(r,t,_);n&&n.length&&(_=_.not(n)),_.appendTo(r)}_=null},M.receive=function(e,t){t.item.sortable.received=!0},M.remove=function(e,t){"dropindex"in t.item.sortable||(r.sortable("cancel"),t.item.sortable.cancel()),t.item.sortable.isCanceled()||o.$apply(function(){t.item.sortable.moved=i.$modelValue.splice(t.item.sortable.index,1)[0]})},V.helper=function(e){return e&&"function"==typeof e?function(t,n){var o=n.sortable,r=h(n);n.sortable={model:i.$modelValue[r],index:r,source:n.parent(),sourceModel:i.$modelValue,_restore:function(){angular.forEach(n.sortable,function(e,t){n.sortable[t]=void 0}),n.sortable=o}};var l=e.apply(this,arguments);return n.sortable._restore(),n.sortable._isCustomHelperUsed=n!==l,l}:e},o.$watchCollection("uiSortable",function(e,t){var n=u(r);if(n){var o=c(e,t,n);o&&r.sortable("option",o)}},!0),c(x)}function C(){i?y():n.info("ui.sortable: ngModel not provided!",r),r.sortable(x)}function $(){return o.uiSortable&&o.uiSortable.disabled?!1:(C(),$.cancelWatcher(),$.cancelWatcher=angular.noop,!0)}var _,x={},S={"ui-floating":void 0,"ui-model-items":e.items},M={receive:null,remove:null,start:null,stop:null,update:null},V={helper:null};return angular.extend(x,S,e,o.uiSortable),angular.element.fn&&angular.element.fn.jquery?($.cancelWatcher=angular.noop,void($()||($.cancelWatcher=o.$watch("uiSortable.disabled",$)))):void n.error("ui.sortable: jQuery should be included before AngularJS!")}}}]);